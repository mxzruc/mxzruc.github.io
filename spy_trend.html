<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line Chart with D3.js</title>
    <script src='https://d3js.org/d3.v7.min.js'></script>

    <style>
        circle { fill: lightblue; stroke: black; }
        .axis text { font: 12px sans-serif; }
        .axis path, .axis line { fill: none; stroke: #000; shape-rendering: crispEdges; }
    </style>


    <script>
        const width = 928;
        const height = 600;
        const marginTop = 20;
        const marginRight = 30;
        const marginBottom = 30;
        const marginLeft = 50;

        // Function to parse date and number values
        const parseDate = d3.timeParse("%Y-%m-%d");
        const parseNumber = d => +d;
        const formatYear = d3.timeFormat("%Y")

        // Load the data
        d3.csv("spy500_index_value.csv").then(data => {
            // Parse the data
            data.forEach(d => {
                d.date = parseDate(d.date);
                d.close = parseNumber(d.close);
            });

            // Declare the x (horizontal position) scale.
            const x = d3.scaleUtc()
                .domain(d3.extent(data, d => d.date))
                .range([marginLeft, width - marginRight]);

            // Declare the y (vertical position) scale.
            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.close)])
                .range([height - marginBottom, marginTop]);

            // Declare the line generator.
            const line = d3.line()
                .x(d => x(d.date))
                .y(d => y(d.close));

            // Create the SVG container.
            const svg = d3.select("svg")
                .attr("viewBox", [0, 0, width, height])
                .attr("width", width)
                .attr("height", height)
                .attr("style", "max-width: 100%; height: auto; height: intrinsic; font: 10px sans-serif;")
                .style("-webkit-tap-highlight-color", "transparent")
                .style("overflow", "visible");

            // Add the x-axis.
            svg.append("g")
                .attr("transform", `translate(0,${height - marginBottom})`)
                .call(d3.axisBottom(x).tickFormat(formatYear));

            // Add the y-axis, remove the domain line, add grid lines and a label.
            svg.append("g")
                .attr("transform", `translate(${marginLeft},0)`)
                .call(d3.axisLeft(y).tickFormat(d3.format("d")))
                .call(g => g.select(".domain").remove())
                .call(g => g.selectAll(".tick line").clone()
                    .attr("x2", width - marginLeft - marginRight)
                    .attr("stroke-opacity", 0.1))
                .call(g => g.append("text")
                    .attr("x", -marginLeft)
                    .attr("y", 10)
                    .attr("fill", "currentColor")
                    .attr("text-anchor", "start")
                    .text("Daily Close"));

            // Append a path for the line.
            svg.append("path")
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 1.5)
                .attr("d", line(data));



        }).catch(error => {
            console.error('Error loading or parsing data:', error);
        });




    </script>

</head>



<body>

<svg width="930" height="600"></svg>

</body>
</html>